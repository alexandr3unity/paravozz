<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ö–æ—Ä–∑–∏–Ω–∞ - FoodBot</title>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-button-color: #50a8eb;
            --tg-theme-button-text-color: #ffffff;
        }

        body {
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            font-family: system-ui, -apple-system, sans-serif;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }

        .cart-container {
            margin-bottom: 100px;
        }

        .cart-item {
            background: rgba(0,0,0,0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .cart-item h2 {
            margin: 0 0 10px 0;
            font-size: 1.2em;
        }

        .quantity-btn {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            border-radius: 6px;
            padding: 5px 10px;
            margin: 0 5px;
            font-size: 1.1em;
        }

        .place-select, .time-select {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 8px;
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
        }

        .total-price {
            position: fixed;
            bottom: 140px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            padding: 15px;
            background: var(--tg-theme-bg-color);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }

        .bottom-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--tg-theme-bg-color);
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }

        .bottom-panel button {
            background: none;
            border: none;
            padding: 10px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .bottom-panel button.active {
            opacity: 1;
        }

        .bottom-panel img {
            width: 28px;
            height: 28px;
        }
    </style>
</head>
<body>
    <h1>üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h1>
    <div class="cart-container"></div>

    <div class="total-price">
        –ò—Ç–æ–≥–æ: <span id="total-price">0</span>‚ÇΩ
    </div>

    <select class="place-select" id="place-select">
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ –ø–æ–ª—É—á–µ–Ω–∏—è</option>
        <option value="–¢—Ä–∏–æ">–¢—Ä–∏–æ</option>
        <option value="–ú–ê–ö">–ú–ê–ö</option>
        <option value="–ì—Ä–∏–Ω">–ì—Ä–∏–Ω</option>
    </select>

    <select class="time-select" id="time-select" disabled>
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</option>
    </select>

    <div class="bottom-panel">
        <button onclick="window.Telegram.WebApp.close()">
            <img src="https://img.icons8.com/ios/50/back--v1.png" alt="–ù–∞–∑–∞–¥">
        </button>
        <button onclick="location.reload()">
            <img src="https://img.icons8.com/ios/50/refresh--v1.png" alt="–û–±–Ω–æ–≤–∏—Ç—å">
        </button>
        <button class="active">
            <img src="https://img.icons8.com/ios/50/shopping-cart--v1.png" alt="–ö–æ—Ä–∑–∏–Ω–∞">
        </button>
    </div>

    <script>
        const timeSlots = {
            "–¢—Ä–∏–æ": ["10:00", "12:00", "14:00", "16:00"],
            "–ú–ê–ö": ["11:00", "13:00", "15:00", "17:00"],
            "–ì—Ä–∏–Ω": ["09:00", "11:30", "14:30"]
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            if (window.Telegram && window.Telegram.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.MainButton
                    .setText(`–û–ø–ª–∞—Ç–∏—Ç—å ${getTotalPrice()}‚ÇΩ`)
                    .onClick(checkout)
                    .show();
            }
            
            loadCart();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('place-select').addEventListener('change', function() {
                const timeSelect = document.getElementById('time-select');
                timeSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</option>';
                
                if (this.value && timeSlots[this.value]) {
                    timeSlots[this.value].forEach(time => {
                        timeSelect.innerHTML += `<option value="${time}">${time}</option>`;
                    });
                    timeSelect.disabled = false;
                } else {
                    timeSelect.disabled = true;
                }
            });
        }

        function loadCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const container = document.querySelector('.cart-container');
            container.innerHTML = '';
            
            cart.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'cart-item';
                itemElement.innerHTML = `
                    <h2>${item.name}</h2>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <button class="quantity-btn" onclick="changeQuantity('${item.name}', -1)">-</button>
                            <span style="margin: 0 10px">${item.quantity}</span>
                            <button class="quantity-btn" onclick="changeQuantity('${item.name}', 1)">+</button>
                        </div>
                        <div>${item.price * item.quantity}‚ÇΩ</div>
                    </div>
                `;
                container.appendChild(itemElement);
            });

            updateTotalPrice();
        }

        function changeQuantity(name, delta) {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const item = cart.find(i => i.name === name);
            
            if (item) {
                item.quantity += delta;
                if (item.quantity < 1) item.quantity = 1;
                localStorage.setItem('cart', JSON.stringify(cart));
                loadCart();
                
                if (window.Telegram && window.Telegram.WebApp) {
                    Telegram.WebApp.MainButton.setText(`–û–ø–ª–∞—Ç–∏—Ç—å ${getTotalPrice()}‚ÇΩ`);
                }
            }
        }

        function getTotalPrice() {
            return JSON.parse(localStorage.getItem('cart') || '[]')
                .reduce((sum, item) => sum + (item.price * item.quantity), 0);
        }

        function updateTotalPrice() {
            document.getElementById('total-price').textContent = getTotalPrice();
        }

        async function checkout() {
            const cart = JSON.parse(localStorage.getItem('cart'));
            if (!cart?.length) return alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!');
            
            const place = document.getElementById('place-select').value;
            const time = document.getElementById('time-select').value;
            if (!place || !time) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');

            const user = window.Telegram?.WebApp?.initDataUnsafe?.user;
            const orderData = {
                user: {
                    id: user?.id,
                    name: [user?.first_name, user?.last_name].filter(Boolean).join(' '),
                    username: user?.username
                },
                cart,
                total: getTotalPrice(),
                place,
                time,
                date: new Date().toLocaleString()
            };

            try {
                const response = await fetch('https://your-bot-server.com/order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer YOUR_BOT_TOKEN'
                    },
                    body: JSON.stringify(orderData)
                });

                if (response.ok) {
                    localStorage.removeItem('cart');
                    Telegram.WebApp.close();
                } else {
                    alert('–û—à–∏–±–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞!');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è!');
            }
        }
    </script>
</body>
</html>
